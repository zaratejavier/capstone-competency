# Import modules
# import time

# All accounts
users = {
    "root": {
        "password": "gucci-mane",
        "group": "admin",
        "mail": []
    }
}

# Form validation
def validate(form):
    if len(form) > 0:
        return False
    return True

# Login authorization
def loginauth(username, password):
    if username in users:
        if password == users[username]["password"]:
            print("Login successful")
            return True
    return False

# Login
def login():
    while True:
        username = input("Username: ")
        if not len(username) > 0:
            print("Username can't be blank")
        else:
            break
    while True:
        password = input("Password: ")
        if not len(password) > 0:
            print("Password can't be blank")
        else:
            break

    if loginauth(username, password):
        return session(username)
    else:
        print("Invalid username or password")

# Register
def register():
    while True:
        username = input("New username: ")
        if not len(username) > 0:
            print("Username can't be blank")
            continue
        else:
            break
    while True:
        password = input("New password: ")
        if not len(password) > 0:
            print("Password can't be blank")
            continue
        else:
            break
    print("Creating account...")
    users[username] = {}
    users[username]["password"] = password
    users[username]["group"] = "user"
    users[username]["mail"] = []
    # time.sleep(1)
    print("Account has been created")

# Send mail

# User session
def session(username):
    print("Welcome to your account " + username)
    print("Options: view mail | send mail | logout")
    if users[username]["group"] == "admin":
        print("")
    while True:
        option = input(username + " > ")
        if option == "logout":
            print("Logging out...")
            break
        elif option == "view mail":
            print("Current mail:")
            for mail in users[username]["mail"]:
                print(mail)
        elif users[username]["group"] == "admin":
            if option == "user mail":
                print("Whos mail would you like to see?")
                userinfo = input("> ")
                if userinfo in users:
                    for mail in users[userinfo]["mail"]:
                        print(mail)
                else:
                    print("There is no account with that username")
            elif option == "delete mail":
                print("Whos mail would you like to delete?")
                userinfo = input("> ")
                if userinfo in users:
                    print("Deleting " + userinfo + "'s mail...")
                    users[userinfo]["mail"] = []
                    # time.sleep(1)
                    print(userinfo + "'s mail has been deleted")
                else:
                    print("There is no account with that username")
            elif option == "delete account":
                print("Whos account would you like to delete?")
                userinfo = input("> ")
                if userinfo in users:
                    print("Are you sure you want to delete " + userinfo + "'s account?")
                    print("Options: yes | no")
                    while True:
                        confirm = input("> ")
                        if confirm == "yes":
                            print("Deleting " + userinfo + "'s account...")
                            del users[userinfo]
                            # time.sleep(1)
                            print(userinfo + "'s account has been deleted")
                            break
                        elif confirm == "no":
                            print("Canceling account deletion...")
                            # time.sleep(1)
                            print("Account deletion canceled")
                            break
                        else:
                            print(confirm + " is not an option")
                else:
                    print("There is no account with that username")
        else:
            print(option + " is not an option")

# On start
print("Welcome to the system. Please register or login.")
while True:
    print("Options: register | login | exit")
    option = input("> ")
    if option == "login":
        login()
    elif option == "register":
        register()
    elif option == "exit":
        break
    else:
        print(option + " is not an option")

# On exit
print("Shutting down...")
# time.sleep(1)

# ============================================== ============================================== ============================================== ==============================================
import sqlite3
import sys
connection = sqlite3.connect("capstone_data.db")
cursor = connection.cursor()

query=input('Welcome\nEnter "Login" if you already have an account,else enter "Register". ').lower()
if query=="Register":
    while True:
        name=input("Enter your username. ")
        n=cursor.execute('SELECT name FROM login').fetchone()
        n=str(n).strip("('',)'")
        if n==name:
            print('That username already exists,try another one!')
            continue
        else:
            while True:
                email=input("Enter your email. ")
                m=cursor.execute('SELECT email FROM login').fetchone()
                m=str(m).strip("('',)'")
                if m == email:
                    print('That email is already in our database,enter another one!')
                    continue
                else:
                    while True:
                        password=input("Enter your password. ")
                        rpassword=input("Enter your password again. ")
                        if password ==rpassword:
                            cursor.execute('INSERT INTO login VALUES(?,?,?,?)',
                                           (None, name, email, password))
                            connection.commit()
                            print('You are now registered.')
                            sys.exit()

                        else:
                            print('Password does not match')
                            continue
elif query=="login":
    while True:
        email = input("Enter your Email. ")
        password=input("Enter your password. ")
        n=cursor.execute("SELECT email from Users WHERE email='"+email+"'").fetchone()
        print("------",n)
        n = str(n).strip("('',)'")
        print('----',n)
        if n==email:
            pw = cursor.execute("SELECT password from Users WHERE password='"+password+"'").fetchone()
            print("------",pw)
            pw = str(pw).strip("('',)'")
            if pw==password:
                print('You are now logged in.')
                break
            else:
                print('Wrong password.')
        else:
            print('Wrong username.')
else:
    print('Incorrect input.Run script again. ')
connection.close()